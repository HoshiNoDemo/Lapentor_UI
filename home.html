<!-- 
Notas:
    Para que este c처digo resulte, os plugins obrigat처rios no Lapentor s찾o:
        ->Floorplan
        ->Default UI plugins
        ->Scene title
        ->Floorplan
        ->Custom code, obviamente.
    
    Faz copy paste do c처digo abaixo para o Custom Code HTML.
-->


<!--<input class="Overlayed" id="myelement" type="button" value="PRESS ME" onmousedown="hideUI()">
<div id="my-view-list" class="Overlayed">Overlay JSDemoC v0.21</div>-->

<script>


    //Setup
    var marker_list = []
    var current_view = ""
    var current_floor = 0

    // set up the mutation observer
    var observer = new MutationObserver(function (mutations, me) {
        // `mutations` is an array of mutations that occurred
        // `me` is the MutationObserver instance
        var floorplan = document.getElementById('PluginFloorplan');
        if (floorplan) {

            marker_list = [].slice.call(document.getElementsByClassName("thumb ng-binding ng-scope"))
            current_view = document.getElementById("PluginScenetitle").innerText
            
            var mapfloorplan = document.querySelector("#map-floorplan")
            

            init()

            me.disconnect(); // stop observing
            return;
        }
    });

    // start observing
    observer.observe(document, {
    childList: true,
    subtree: true
    });
 

    function init(){
        //Setup a onmouseup listener to check for room and floor changes
        document.addEventListener("mouseup", function(){
            console.log("Initting.")

            //Check if current markers were changed
            setTimeout(function(){
                    var new_marker_list = [].slice.call(document.getElementsByClassName("map-placemarker thumb ng-scope"))

                    var new_current_view = document.getElementById("PluginScenetitle").innerText

                    if (current_view && current_view !== new_current_view){
                        if (isCanvasClear(document.getElementById("canvas-map"))){
                            console.log("CHANGED FLOOR!")
                        }
                    }
                    current_view = new_current_view
                    marker_list = new_marker_list

                },1000)
        })

        document.addEventListener("mousedown", function(event){
            if(event.target.className == "map-placemarker thumb ng-scope"){
                console.log("MARKER!")

                var asdf = document.getElementById("PluginFloorplan").getElementsByClassName("list")
                var asdf2 = asdf[0].children.

                b = Array.prototype.slice.call( asdf2 )
                current_floor = b.indexOf(b.find(function(element){
	                return element.className == "thumb ng-binding ng-scope active"
                }))

                console.log(asdf2)
            }
            console.log(event.target)
        })
    }

    function isCanvasClear(canvas){
        return !canvas.getContext('2d')
            .getImageData(0, 0, canvas.width, canvas.height).data
            .some(channel => channel !== 0);
    }

    function htmlEquals(a1, a2) {
        if(a1.length !== a2.length)
            return false;
        for(var i = a1.length; i--;) {
            if(a1[i].innerHTML !== a2[i].innerHTML)
                return false;
        }
        return true;
    }

    /**
    * Hides the top right scene selection.
    */
    function hideUI() {
        var x = document.getElementById('scenelist-ghost')
        
        if (x.style.display === "none"){
            x.style.display = "block"
        } else {
            x.style.display = "none"
        }
    }
</script>    